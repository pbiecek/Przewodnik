# Jak wyznaczać odległosć pomiędzy obserwacjami?

Analiza skupisk jest oparta o odległości pomiędzy obserwacjami. 
Poprawne określenie odległości jest *być albo nie być* dla poprawności wyników.

W kolejnych podrozdziałach opiszemy różne algorytmy identyfikacji skupisk, ale nie ma znaczenia której metody używamy jeżeli źle określimy odegłości.

Weźmy dwie obserwacje, $$x=(x_1, ..., x_n)$$ i $$y=(y_1, ..., y_n)$$.

Typowe definicje funkcji odległości pomiędzy nimi to:

## Typowe wybory dla zmiennych ilościowych

### Odległość Euklidesowa

Standardowa odległość w $$R^n$$

$$
d(x, y) = \sqrt{\sum_i (x_i - y_i)^2}.
$$

### Odległość maksimum

Maksymalna odległość po współrzędnych.

$$
d(x, y) = \max_i{|x_i - y_i|}.
$$

### Odległość Manhattan (taksówkowa)

Suma odległości po współrzędnych

$$
d(x, y) = \sum_i{|x_i - y_i|}.
$$

### Odległość Canberra

Ważona wersja odległości Manhattan, stosowana dla danych o zliczeniach (np. o rozkłądzie zbliżonym do Poissona), uporządkowanych rankinkach itp.

$$
d(x, y) = \sum_i{\frac{|x_i - y_i|}{|x_i| + |y_i|}}
$$

## Typowe wybory dla zmiennych ilościowych

### Odległość Hamminga

Liczba różnych współrzędnych. Często wykorzystywana dla ciągów cyfr lub liter, ale też dla binarnych wektorów.

$$
d(x, y) = \#\{i: x_i \neq y_i\}
$$

### Odległość Jaccarda

Dla wektorów binarnych, najprostsza interpretacja to: wielkosć przecięcia podzielona na wielkość części sumy.
Często używana przez ekologów, gdyby bada się jak często dwa gatunki współwystępują, sensownie jest porównywać jak często występują razem do miejsc gdzie występuje przynajmniej jeden z nich

$$
d(x, y) = \frac{\#\{(i: x_i == 1) \wedge (y_i == 1)\}}{\#\{(i: x_i == 1) \vee (y_i == 1)\}}.
$$


## Nietypowe wybory

Jeżeli analizujemy wektor zmiennych o zbliżonych charakterystykach to możemy wybrać którąś z powyższych metryk.
Ale:

* Jeżeli elementy wektora są w znacząco różnych zakresach zmienności to często rozsądnym pomysłem jest unormowanie każdej ze współrzędnych osobno (np. długość w metrach i milimetrach). Umornować można tak by średnia była róna 0 i sd 1 lub by zakres zmienności wynosił [0,1] lub w inny sposób (np przez rangi).

* Jeżeli elementy $$x$$ i $$y$$ składają się z róznych zmiennych, np. jakościowych (kraj pochodzenia) i ilościowych (wiek) to możemy na poszczególnych współrzędnych wyznaczać częstkowe macierze odległości a następnie je składać.

* Często nie jest oczywiste jak liczyć odległość. Przypuśćmy że porównujemy głosowania posłów (za, przeciw, wstrzymał się, nie było go) - odległość pomiędzy głosowaniami można różnie określać. Lub przypuśćmy że porównujemy korpusy tekstów. Co będzie dobrą miarą podobieństwa napisów? A gdy porównujemy obrazy? Często nei ma sensu porównywanie bezpośrednio obrazów, ale najpierw wyznacza się cechy ktł®e już można porównywać w bardziej klasyczny sposób.


## A jak to zrobić w R?

Najprostszy sposób by policzyć odległość w R jest przez użycie wynkcji `dist()`. Są w niej zaimplementowane powyżej opisane odległości.

```{r}
kwiatkow5 <- iris[1:5,1:4]

dist(kwiatkow5)
dist(kwiatkow5, method = "manhattan")
as.matrix(dist(kwiatkow5, method = "max"))
```

Łatwość jej użycia niesie ryzyko stosowania jej bez głębszej reflekcji jakie odległości mają sens. 
Powtórzmy więc **w analizie skupisk kluczowy jest wybór odległości**.

## Pokaż ją!

Macierz odległości (o ile nei jest duża) można przedstawiać graficznie z użyciem tzw. mapy ciepła. Więcej o tym jak jest konstruowana w kolejnych rozdziałach.

```{r}
d <- as.matrix(dist(kwiatkow5, method = "max"))

heatmap(d, symm = TRUE)
```

